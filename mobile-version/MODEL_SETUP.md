# Model Setup Instructions

## ‚ö†Ô∏è Important: Model File Too Large for GitHub

The PyTorch Mobile model file (`distilbert_model.ptl`) is **255.51 MB**, which exceeds GitHub's 100 MB file size limit. Therefore, **the model file is NOT committed to git** and must be generated locally.

## üìã Prerequisites

1. **Python 3.9+** with PyTorch installed
2. **Trained DistilBERT model** at: `../mybudget-ai/models/distilbert_multitask_latest/`
3. **PyTorch Mobile** library (will be installed during conversion)

## üöÄ Generating the Model File

### Step 1: Install Dependencies

```bash
cd mobile-version
pip install torch torchvision torchaudio
```

### Step 2: Run Conversion Script

The conversion script will:
- Load the trained DistilBERT model
- Convert it to TorchScript
- Optimize for mobile with INT8 quantization
- Save as `.ptl` (PyTorch Lite) format

```bash
cd mobile-version
python3 convert_to_pytorch_mobile.py
```

**Expected Output:**
```
üöÄ PyTorch Mobile Conversion
üì• Loading model from ../mybudget-ai/models/distilbert_multitask_latest/...
‚è≥ Converting to TorchScript...
‚úÖ Model traced successfully
üíæ Saving optimized model to app/src/main/assets/distilbert_model.ptl...
‚úÖ CONVERSION COMPLETE!
üì¶ Model file: app/src/main/assets/distilbert_model.ptl
üìä Model size: ~255 MB
```

### Step 3: Verify Model File

After conversion, verify the file exists:

```bash
ls -lh mobile-version/app/src/main/assets/distilbert_model.ptl
```

You should see a file ~255 MB in size.

## üì± Adding Model to Android Project

The model file should be placed in:
```
mobile-version/app/src/main/assets/distilbert_model.ptl
```

**Note:** The `assets/` directory is already in git, but `distilbert_model.ptl` is ignored via `.gitignore`.

### Required Files in Assets:

1. ‚úÖ `distilbert_model.ptl` - Generated by conversion script (not in git)
2. ‚úÖ `model_info.json` - Model metadata (committed)
3. ‚úÖ `vocab.txt` - Vocabulary file (committed)

## üîß Troubleshooting

### Model Directory Not Found

**Error:** `Model directory not found`

**Solution:** Ensure the trained model exists:
```bash
ls ../mybudget-ai/models/distilbert_multitask_latest/
```

Should contain:
- `config.json`
- `model.safetensors` or `pytorch_model.bin`
- `tokenizer.json`
- `vocab.txt`

### Import Errors

**Error:** `ImportError: No module named 'distilbert_inference'`

**Solution:** The script automatically adds the project paths. If it fails:
```bash
export PYTHONPATH="${PYTHONPATH}:../mybudget-ai"
python3 convert_to_pytorch_mobile.py
```

### Quantization Backend Errors

**Error:** Backend optimization fails

**Solution:** The script will automatically fall back to non-quantized model. This is fine - the model will work but be slightly larger.

### File Size Still Too Large

If the model file is still very large (>100MB):
1. Check if quantization succeeded (look for "INT8 quantization" in logs)
2. The script uses INT8 quantization which reduces size by ~4x
3. If quantization fails, the model will be larger but still functional

## üìù Build Process

### During Development:

1. **First Time Setup:**
   ```bash
   cd mobile-version
   python3 convert_to_pytorch_mobile.py
   ```

2. **Build Android App:**
   ```bash
   ./gradlew assembleDebug
   ```

3. **Install on Device:**
   ```bash
   ./gradlew installDebug
   ```

### For New Team Members:

1. Clone the repository (model file won't be included)
2. Run the conversion script to generate the model file
3. Build the app as normal

## üéØ Alternative: Use Git LFS (Optional)

If you want to track the model file in git, you can use Git LFS:

```bash
# Install Git LFS
brew install git-lfs  # macOS
# or download from https://git-lfs.github.com/

# Initialize Git LFS
git lfs install

# Track .ptl files
git lfs track "*.ptl"
git add .gitattributes
git add mobile-version/app/src/main/assets/distilbert_model.ptl
git commit -m "Add model file via Git LFS"
```

**Note:** Git LFS requires GitHub LFS storage (1 GB free, then paid). For this project, generating locally is recommended.

## ‚úÖ Verification Checklist

- [ ] Model conversion script runs successfully
- [ ] `distilbert_model.ptl` exists in `app/src/main/assets/`
- [ ] Model file size is reasonable (~255 MB)
- [ ] `model_info.json` and `vocab.txt` are present
- [ ] Android app builds successfully
- [ ] ML inference works in the app

## üìö Related Files

- **Conversion Script:** `mobile-version/convert_to_pytorch_mobile.py`
- **Inference Service:** `mobile-version/app/src/main/java/com/budgetbuddy/mobile/ml/PyTorchMobileInferenceService.kt`
- **Model Source:** `mybudget-ai/models/distilbert_multitask_latest/`

